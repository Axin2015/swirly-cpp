INCLUDE(TestBigEndian)
TEST_BIG_ENDIAN(WORDS_BIGENDIAN)
ADD_DEFINITIONS(-DWORDS_BIGENDIAN=${WORDS_BIGENDIAN})

INCLUDE_DIRECTORIES("${PROJECT_SOURCE_DIR}/include")
INCLUDE_DIRECTORIES("${PROJECT_SOURCE_DIR}/src")

IF("${CMAKE_CXX_COMPILER_ID}" STREQUAL "Clang")
  SET(CMAKE_C_FLAGS "-std=c11 -Wall -Werror -Wno-unused-const-variable  -fstrict-aliasing -fvisibility=hidden")
ENDIF()

IF(RAGEL)
  ADD_CUSTOM_COMMAND(
    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
    DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/shlex.rl
    COMMAND ${RAGEL} ${CMAKE_CURRENT_SOURCE_DIR}/shlex.rl -o ${CMAKE_CURRENT_SOURCE_DIR}/shlex.c
    OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/shlex.c
    )
ENDIF(RAGEL)

FILE(GLOB ash_SOURCES "*.c")
LIST(REMOVE_ITEM ash_SOURCES ${CMAKE_CURRENT_SOURCE_DIR}/shlex.c)

ADD_LIBRARY(ash_shared SHARED ${ash_SOURCES} ${CMAKE_CURRENT_SOURCE_DIR}/shlex.c)
SET_TARGET_PROPERTIES(ash_shared PROPERTIES OUTPUT_NAME sc_ash)
TARGET_LINK_LIBRARIES(ash_shared m)

ADD_LIBRARY(ash_static STATIC ${ash_SOURCES} ${CMAKE_CURRENT_SOURCE_DIR}/shlex.c)
SET_TARGET_PROPERTIES(ash_static PROPERTIES OUTPUT_NAME sc_ash)
TARGET_LINK_LIBRARIES(ash_static m)

ADD_LIBRARY(ash_pic STATIC ${ash_SOURCES} ${CMAKE_CURRENT_SOURCE_DIR}/shlex.c)
SET_TARGET_PROPERTIES(ash_pic PROPERTIES OUTPUT_NAME sc_ash_pic)
SET_TARGET_PROPERTIES(ash_pic PROPERTIES COMPILE_FLAGS "${CMAKE_SHARED_LIBRARY_C_FLAGS}")
TARGET_LINK_LIBRARIES(ash_pic m)

INSTALL(TARGETS ash_shared DESTINATION lib)
INSTALL(TARGETS ash_static DESTINATION lib)
