CMAKE_MINIMUM_REQUIRED(VERSION 2.8.3)
PROJECT(dbr)

SET(CMAKE_VERBOSE_MAKEFILE 1)

IF(NOT CMAKE_BUILD_TYPE)
  SET(CMAKE_BUILD_TYPE DEBUG)
  #SET(CMAKE_BUILD_TYPE RELEASE)
  #SET(CMAKE_BUILD_TYPE RELWITHDEBINFO)
  #SET(CMAKE_BUILD_TYPE MINSIZEREL)
ENDIF()

IF(CMAKE_COMPILER_IS_GNUCC)
  SET(CMAKE_C_FLAGS "-std=c11 -Wall -Werror -fstrict-aliasing -fvisibility=hidden")
  SET(CMAKE_CXX_FLAGS "-std=c++11 -Wall -Werror -fstrict-aliasing -fvisibility=hidden")
  SET(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} -Wl,--no-undefined")
ENDIF()

#ADD_DEFINITIONS(-DDBR_DEBUG_ALLOC -DDBR_DEBUG_LEVEL=1)

SET(EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin)
SET(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)
SET(CMAKE_INSTALL_PREFIX "$ENV{HOME}/doobry/")

FILE(MAKE_DIRECTORY ${EXECUTABLE_OUTPUT_PATH})
FILE(MAKE_DIRECTORY ${LIBRARY_OUTPUT_PATH})

FIND_PACKAGE(Doxygen) # Optional.

IF(DOXYGEN_FOUND)
  CONFIGURE_FILE(${PROJECT_SOURCE_DIR}/Doxyfile.in
    ${PROJECT_BINARY_DIR}/Doxyfile)

  ADD_CUSTOM_TARGET(doc ALL
    COMMAND ${CMAKE_COMMAND} -E make_directory ${PROJECT_BINARY_DIR}/share
    COMMAND ${DOXYGEN_EXECUTABLE} ${PROJECT_BINARY_DIR}/Doxyfile
    SOURCES ${PROJECT_BINARY_DIR}/Doxyfile)

  INSTALL(DIRECTORY ${PROJECT_BINARY_DIR}/share/doc DESTINATION share)
ENDIF()

ENABLE_TESTING()

ADD_SUBDIRECTORY(etc)
ADD_SUBDIRECTORY(include)
ADD_SUBDIRECTORY(src)
ADD_SUBDIRECTORY(test)
